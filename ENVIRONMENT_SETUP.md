# Настройка сред разработки

Данный документ описывает настройку и различия между средами разработки на платформе QazTech.

**Для пошагового руководства по развертыванию см. [STEP_BY_STEP_GUIDE.md](STEP_BY_STEP_GUIDE.md)**

## Обзор сред

На платформе QazTech автоматически создаются 5 изолированных сред для различных стадий жизненного цикла разработки:

1. **DEV** (Development) - Среда разработки
2. **TEST** (Testing) - Среда тестирования
3. **STRESSTEST** - Среда нагрузочного тестирования
4. **STAGE** (Staging) - Предрелизная среда
5. **PROD** (Production) - Рабочая среда

## DEV (Development)

### Назначение

Среда для непосредственной работы разработчиков. Используется для:
- Написания нового кода
- Экспериментов и прототипирования
- Интеграции новых функций
- Быстрой проверки изменений

### Характеристики

- **Ресурсы:** Минимальные (small/medium флейворы)
- **Доступность:** Не критична
- **Данные:** Тестовые данные, можно очищать
- **Мониторинг:** Базовый
- **Безопасность:** Стандартные меры

### Настройка

```bash
# Создание инфраструктуры
./scripts/deployment/01-create-network.sh dev myproject 10.10.0.0/24
./scripts/deployment/03-create-vms.sh dev myproject qp_myproject_dev myproject_deploy_key

# Настройка инструментов
./scripts/deployment/05-setup-nexus.sh myproject
./scripts/deployment/06-setup-harbor.sh myproject
./scripts/deployment/07-setup-vault.sh myproject dev
```

### Развертывание

Развертывание в DEV происходит автоматически при push в ветку `develop` или вручную через GitLab CI/CD.

### URL

- Frontend: `https://dev.myproject.qaztech.gov.kz`
- Backend API: `https://api-dev.myproject.qaztech.gov.kz`

## TEST (Testing)

### Назначение

Среда для функционального и интеграционного тестирования. Используется для:
- Функционального тестирования новых функций
- Интеграционного тестирования компонентов
- Проверки работоспособности кода QA-инженерами
- Регрессионного тестирования

### Характеристики

- **Ресурсы:** Средние (medium флейворы)
- **Доступность:** Важна для процесса тестирования
- **Данные:** Тестовые данные, близкие к реальным
- **Мониторинг:** Расширенный
- **Безопасность:** Стандартные меры

### Настройка

Аналогично DEV среде, но с другими параметрами:

```bash
./scripts/deployment/01-create-network.sh test myproject 10.10.1.0/24
./scripts/deployment/03-create-vms.sh test myproject qp_myproject_test myproject_deploy_key
```

### Развертывание

Развертывание в TEST происходит вручную через GitLab CI/CD после успешного прохождения тестов в DEV.

### URL

- Frontend: `https://test.myproject.qaztech.gov.kz`
- Backend API: `https://api-test.myproject.qaztech.gov.kz`

## STRESSTEST

### Назначение

Среда для нагрузочного и стресс-тестирования. Используется для:
- Проверки производительности под нагрузкой
- Нагрузочного тестирования
- Стресс-тестирования
- Проверки масштабируемости

### Характеристики

- **Ресурсы:** Увеличенные (large флейворы, возможно несколько инстансов)
- **Доступность:** Не критична
- **Данные:** Синтетические данные для нагрузочного тестирования
- **Мониторинг:** Детальный мониторинг производительности
- **Безопасность:** Стандартные меры

### Настройка

```bash
./scripts/deployment/01-create-network.sh stresstest myproject 10.10.2.0/24
./scripts/deployment/03-create-vms.sh stresstest myproject qp_myproject_stresstest myproject_deploy_key
```

### Инструменты нагрузочного тестирования

Рекомендуемые инструменты:
- Apache JMeter
- Gatling
- k6
- Locust

### Развертывание

Развертывание в STRESSTEST происходит вручную при необходимости проведения нагрузочных испытаний.

## STAGE (Staging)

### Назначение

Предрелизная среда, максимально приближенная к PROD. Используется для:
- Финального тестирования перед релизом
- Проверки совместимости с production данными
- User Acceptance Testing (UAT)
- Демонстрации функционала заказчику

### Характеристики

- **Ресурсы:** Аналогичны PROD (medium/large флейворы)
- **Доступность:** Высокая
- **Данные:** Копия production данных (обезличенные)
- **Мониторинг:** Полный мониторинг как в PROD
- **Безопасность:** Усиленные меры безопасности

### Настройка

```bash
./scripts/deployment/01-create-network.sh stage myproject 10.10.3.0/24
./scripts/deployment/03-create-vms.sh stage myproject qp_myproject_stage myproject_deploy_key
```

### Развертывание

Развертывание в STAGE происходит вручную через GitLab CI/CD после успешного прохождения всех тестов.

### URL

- Frontend: `https://stage.myproject.qaztech.gov.kz`
- Backend API: `https://api-stage.myproject.qaztech.gov.kz`

## PROD (Production)

### Назначение

Рабочая среда с готовыми, протестированными версиями. Доступна реальным пользователям.

### Характеристики

- **Ресурсы:** Максимальные, с возможностью масштабирования
- **Доступность:** Критична (99.9%+)
- **Данные:** Реальные production данные
- **Мониторинг:** Полный мониторинг с алертингом
- **Безопасность:** Максимальные меры безопасности

### Требования

- Высокодоступная архитектура (HA)
- Автоматическое масштабирование
- Резервное копирование и план аварийного восстановления
- Усиленный мониторинг и алертинг
- Балансировщики нагрузки
- SSL сертификаты
- Регулярные обновления безопасности

### Настройка

```bash
./scripts/deployment/01-create-network.sh prod myproject 10.10.4.0/24
./scripts/deployment/03-create-vms.sh prod myproject qp_myproject_prod myproject_deploy_key
```

### Развертывание

Развертывание в PROD происходит вручную через GitLab CI/CD только после:
- Успешного прохождения всех тестов
- Успешного развертывания в STAGE
- Получения одобрения от ответственного лица
- Создания тега версии

### URL

- Frontend: `https://myproject.qaztech.gov.kz`
- Backend API: `https://api.myproject.qaztech.gov.kz`

## Сравнительная таблица сред

| Параметр | DEV | TEST | STRESSTEST | STAGE | PROD |
|----------|-----|------|------------|-------|------|
| Ресурсы | Минимальные | Средние | Увеличенные | Как PROD | Максимальные |
| Доступность | Не критична | Важна | Не критична | Высокая | Критична |
| Данные | Тестовые | Тестовые | Синтетические | Копия PROD | Реальные |
| Мониторинг | Базовый | Расширенный | Детальный | Полный | Полный + алерты |
| Безопасность | Стандартная | Стандартная | Стандартная | Усиленная | Максимальная |
| Развертывание | Автоматическое | Ручное | Ручное | Ручное | Ручное + одобрение |
| Резервное копирование | Нет | Опционально | Нет | Да | Обязательно |

## Рекомендации по использованию

### Workflow разработки

1. **Разработка:** Разработчик создает feature branch и работает в DEV
2. **Тестирование:** После merge в develop, код автоматически развертывается в DEV
3. **QA тестирование:** После проверки в DEV, код развертывается в TEST для QA
4. **Нагрузочное тестирование:** При необходимости, код развертывается в STRESSTEST
5. **Предрелизное тестирование:** После всех проверок, код развертывается в STAGE
6. **Production:** После финального одобрения, код развертывается в PROD

### Управление секретами

Для каждой среды используются отдельные секреты в Vault:
- `secret/myproject/dev/*`
- `secret/myproject/test/*`
- `secret/myproject/stresstest/*`
- `secret/myproject/stage/*`
- `secret/myproject/prod/*`

### Мониторинг

Настроить отдельные дашборды в Grafana для каждой среды с соответствующими фильтрами.

### Логирование

Использовать разные индексы в OpenSearch для каждой среды:
- `myproject-dev-logs-*`
- `myproject-test-logs-*`
- `myproject-stresstest-logs-*`
- `myproject-stage-logs-*`
- `myproject-prod-logs-*`

